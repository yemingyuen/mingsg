;(function(n,e){var c=n.customize,d,g={},h,k,m,l,p=_youxiCustomizeWebFonts;c&&(c.Youxi=c.Youxi||{},c.Youxi.WebFontControl=c.Control.extend({ready:function(){var a=this,b=a.container.find(".youxi-webfont-control-providers"),f=a.setting();a.activeProvider="";a.providerViews={};_.isString(f)||(f="");if(f=/^(typekit|google|websafe)\/(.+)$/.exec(f))a.activeProvider=f[1];b.children("[data-provider-id]").each(function(){var b=this,f=e(b).data("provider-id"),c;_.each(g,function(e,d){d=d.toLowerCase();f.toLowerCase()==d&&(c=new l({id:d}),c.on("change",function(b){a.activeProvider==b.id&&a.setting.set(b.getValue())}),a.providerViews[d]=new e({id:d,el:b,model:c}))})});a.container.on("change",".youxi-webfont-control-sources",function(b){_.invoke(a.providerViews,"deactivate");_.has(a.providerViews,this.value)?(a.activeProvider=this.value,a.providerViews[a.activeProvider].activate()):(a.activeProvider=null,a.setting.set(""))})}}),l=c.Youxi.WebFontModel=Backbone.Model.extend({defaults:{family:"",variation:"",subsets:[]},reset:function(a){this.set(l.prototype.defaults,a)},getValue:function(){var a=[],b=this.get("family"),c=this.get("variation"),d=this.get("subsets");return b?(a.push(b),c&&a.push(c),d=d.length?"&subset="+d.join(","):"",[this.id,a.join(":")+d].join("/")):""}}),h=Backbone.View.extend({show:function(){this.$el.show()},hide:function(){this.$el.hide()}}),k=h.extend({val:function(a){if(_.isUndefined(a))return this.$("select").val();this.$("select > option").each(function(){e(this).prop("selected",this.value===a)})},createOption:function(a,b){return e("<option />").attr("value",b).text(a)},reset:function(){this.$("select > option").not(".placeholder").prop("selected",!1)},empty:function(){this.$("select > option").not(".placeholder").remove()},update:function(a,b){this.$("select").empty().append(_.map(a,this.createOption));this.val(b)}}),m=h.extend({val:function(a){if(_.isUndefined(a))return this.$(":checkbox:checked").map(function(){return this.value}).get();this.$(":checkbox").each(function(){e(this).prop("checked",0<_.indexOf(a,this.value))})},createCheckbox:function(a,b){return e("<label />").html('<input type="checkbox" value="'+b+'">'+a+"<br>")},reset:function(){this.$(":checkbox").prop("checked",!1)},empty:function(){this.$(":checkbox").remove()},update:function(a,b){this.$(".checkboxes").empty().append(_.map(a,this.createCheckbox));this.val(b)}}),d=c.Youxi.WebFontView=Backbone.View.extend({events:{"change .youxi-webfont-provider-family select":"updateFamily","change .youxi-webfont-provider-variation select":"updateVariation"},initialize:function(){Backbone.View.prototype.initialize.apply(this,arguments);this.fonts=p[this.id]||{};this.familyDropdownView=new k({el:this.$(".youxi-webfont-provider-family").get(0)});this.variationDropdownView=new k({el:this.$(".youxi-webfont-provider-variation").get(0)});this.model.set("family",this.familyDropdownView.val(),{silent:!0});this.model.set("variation",this.variationDropdownView.val(),{silent:!0});this.listenTo(this.model,"change:family",this.refresh)},refresh:function(){},activate:function(){this.model.trigger("change",this.model);this.$el.removeClass("youxi-webfont-provider-inactive")},deactivate:function(){this.$el.addClass("youxi-webfont-provider-inactive")},updateFamily:function(){this.model.set("family",this.familyDropdownView.val())},updateVariation:function(){this.model.set("variation",this.variationDropdownView.val())}}),d.Websafe=g.Websafe=c.Youxi.WebFontView.extend({refresh:function(a,b){b?(this.variationDropdownView.val("n4"),this.variationDropdownView.show()):(this.variationDropdownView.val(""),this.variationDropdownView.hide());this.updateVariation()}}),d.Google=g.Google=c.Youxi.WebFontView.extend({events:_.extend({},d.prototype.events,{"change .youxi-webfont-provider-subsets :checkbox":"updateSubsets"}),initialize:function(){d.prototype.initialize.apply(this,arguments);this.subsetCheckboxes=new m({el:this.$(".youxi-webfont-provider-subsets").get(0)});this.model.set("subsets",this.subsetCheckboxes.val(),{silent:!0})},refresh:function(a,b){if(_.has(this.fonts,b)){var c=this.fonts[b].variants||[],d=this.fonts[b].subsets||[];this.variationDropdownView.update(_.object(c,c),"regular");this.variationDropdownView.show();this.updateVariation();this.subsetCheckboxes.update(_.object(d,d));this.subsetCheckboxes.show()}else this.variationDropdownView.empty(),this.variationDropdownView.hide(),this.updateVariation(),this.subsetCheckboxes.empty(),this.subsetCheckboxes.hide();this.updateSubsets()},updateSubsets:function(){this.model.set("subsets",this.subsetCheckboxes.val())}}),d.Typekit=g.Typekit=c.Youxi.WebFontView.extend({refresh:function(a,b){var c=_.findWhere(this.fonts,{id:b});_.isUndefined(c)?(this.variationDropdownView.empty(),this.variationDropdownView.hide()):(this.variationDropdownView.update(c.variations||{},"n4"),this.variationDropdownView.show());this.updateVariation()}}),e.extend(c.controlConstructor,{youxi_webfont:c.Youxi.WebFontControl}))})(window.wp,jQuery);