/*
* Copyright (C) 2009 Joel Sutherland
* Licenced under the MIT license
* http://www.newmediacampaigns.com/page/jquery-flickr-plugin
*
* Available tags for templates:
* title, link, date_taken, description, published, author, author_id, tags, image*
*/
(function(d){d.fn.jflickrfeed=function(b,f){b=d.extend(!0,{flickrbase:"http://api.flickr.com/services/feeds/",feedapi:"photos_public.gne",limit:20,qstrings:{lang:"en-us",format:"json",jsoncallback:"?"},cleanDescription:!0,useTemplate:!0,itemTemplate:"",itemCallback:function(){}},b);var a=b.flickrbase+b.feedapi+"?",g=!0,h;for(h in b.qstrings)g||(a+="&"),a+=h+"="+b.qstrings[h],g=!1;return d(this).each(function(){var h=d(this),g=this;d.getJSON(a,function(a){d.each(a.items,function(a,c){if(a<b.limit){if(b.cleanDescription){var e=/<p>(.*?)<\/p>/g,f=c.description;e.test(f)&&(c.description=f.match(e)[2],void 0!=c.description&&(c.description=c.description.replace("<p>","").replace("</p>","")))}d.each("s q t m n  z c b h k".split(" "),function(b,a){c["image_"+a]=c.media.m.replace("_m",a?"_"+a:"")});delete c.media;if(b.useTemplate){var e=b.itemTemplate,k;for(k in c)e=e.replace(new RegExp("{{"+k+"}}","g"),c[k]);h.append(e)}b.itemCallback.call(g,c)}});d.isFunction(f)&&f.call(g,a)})})}})(jQuery);