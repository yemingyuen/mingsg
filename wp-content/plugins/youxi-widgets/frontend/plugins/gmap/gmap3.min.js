/*!
 *  GMAP3 Plugin for jQuery
 *  Version   : 6.0.0
 *  Date      : 2014-04-25
 *  Author    : DEMONTE Jean-Baptiste
 *  Contact   : jbdemonte@gmail.com
 *  Web site  : http://gmap3.net
 *  Licence   : GPL v3 : http://www.gnu.org/licenses/gpl.html
 *  Build options : --only --marker --destroy

 *  Copyright (c) 2010-2014 Jean-Baptiste DEMONTE
 *  All rights reserved.
 */
!function(t,n){function e(t){return"object"==typeof t}function r(t){return"string"==typeof t}function o(t){return"number"==typeof t}function a(t){return t===n}function i(){q=google.maps,B||(B={verbose:!1,queryLimit:{attempt:5,delay:250,random:250},classes:function(){var n={};return t.each("Map Marker InfoWindow Circle Rectangle OverlayView StreetViewPanorama KmlLayer TrafficLayer BicyclingLayer GroundOverlay StyledMapType ImageMapType".split(" "),function(t,e){n[e]=q[e]}),n}(),map:{mapTypeId:q.MapTypeId.ROADMAP,center:[46.578498,2.457275],zoom:2},overlay:{pane:"floatPane",content:"",offset:{x:0,y:0}},geoloc:{getCurrentPosition:{maximumAge:6e4,timeout:5e3}}})}function u(t,n){return a(t)?"gmap3_"+(n?A+1:++A):t}function s(n,e,r,o,a){function i(e,o){e&&t.each(e,function(t,e){var i=n,u=e;C(e)&&(i=e[0],u=e[1]),o(r,t,function(t){u.apply(i,[a||r,t,s])})})}var u=e.td||{},s={id:o,data:u.data,tag:u.tag};i(u.events,q.event.addListener),i(u.onces,q.event.addListenerOnce)}function l(t){var n,e=[];for(n in t)t.hasOwnProperty(n)&&e.push(n);return e}function c(t,n){var e,r=arguments;for(e=2;e<r.length;e++)if(n in r[e]&&r[e].hasOwnProperty(n))return void(t[n]=r[e][n])}function f(n,e){var r,o,a=["data","tag","id","events","onces"],i={};if(n.td)for(r in n.td)n.td.hasOwnProperty(r)&&"options"!==r&&"values"!==r&&(i[r]=n.td[r]);for(o=0;o<a.length;o++)c(i,a[o],e,n.td);return i.options=t.extend({},n.opts||{},e.options||{}),i}function g(){if(B.verbose){var t,n=[];if(window.console&&x(console.error)){for(t=0;t<arguments.length;t++)n.push(arguments[t]);console.error.apply(console,n)}else{for(n="",t=0;t<arguments.length;t++)n+=arguments[t].toString()+" ";alert(n)}}}function p(t){return(o(t)||r(t))&&""!==t&&!isNaN(t)}function d(t){var n,r=[];if(!a(t))if(e(t))if(o(t.length))r=t;else for(n in t)r.push(t[n]);else r.push(t);return r}function h(n){return n?x(n)?n:(n=d(n),function(r){var o;if(a(r))return!1;if(e(r)){for(o=0;o<r.length;o++)if(t.inArray(r[o],n)>=0)return!0;return!1}return t.inArray(r,n)>=0}):void 0}function v(t,n,e){var o=n?t:null;return!t||r(t)?o:t.latLng?v(t.latLng):t instanceof q.LatLng?t:p(t.lat)?new q.LatLng(t.lat,t.lng):!e&&C(t)&&p(t[0])&&p(t[1])?new q.LatLng(t[0],t[1]):o}function y(t){var n,e;return!t||t instanceof q.LatLngBounds?t||null:(C(t)?2===t.length?(n=v(t[0]),e=v(t[1])):4===t.length&&(n=v([t[0],t[1]]),e=v([t[2],t[3]])):"ne"in t&&"sw"in t?(n=v(t.ne),e=v(t.sw)):"n"in t&&"e"in t&&"s"in t&&"w"in t&&(n=v([t.n,t.e]),e=v([t.s,t.w])),n&&e?new q.LatLngBounds(e,n):null)}function m(t,n,e,o,a){var i=e?v(o.td,!1,!0):!1,u=i?{latLng:i}:o.td.address?r(o.td.address)?{address:o.td.address}:o.td.address:!1,s=u?G.get(u):!1,l=this;u?(a=a||0,s?(o.latLng=s.results[0].geometry.location,o.results=s.results,o.status=s.status,n.apply(t,[o])):(u.location&&(u.location=v(u.location)),u.bounds&&(u.bounds=y(u.bounds)),j().geocode(u,function(r,i){i===q.GeocoderStatus.OK?(G.store(u,{results:r,status:i}),o.latLng=r[0].geometry.location,o.results=r,o.status=i,n.apply(t,[o])):i===q.GeocoderStatus.OVER_QUERY_LIMIT&&a<B.queryLimit.attempt?setTimeout(function(){m.apply(l,[t,n,e,o,a+1])},B.queryLimit.delay+Math.floor(Math.random()*B.queryLimit.random)):(g("geocode failed",i,u),o.latLng=o.results=!1,o.status=i,n.apply(t,[o]))}))):(o.latLng=v(o.td,!1,!0),n.apply(t,[o]))}function L(n,e,r,o){function a(){do u++;while(u<n.length&&!("address"in n[u]));return u>=n.length?void r.apply(e,[o]):void m(i,function(e){delete e.td,t.extend(n[u],e),a.apply(i,[])},!0,{td:n[u]})}var i=this,u=-1;a()}function w(t,n,e){var r=!1;navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){r||(r=!0,e.latLng=new q.LatLng(o.coords.latitude,o.coords.longitude),n.apply(t,[e]))},function(){r||(r=!0,e.latLng=!1,n.apply(t,[e]))},e.opts.getCurrentPosition):(e.latLng=!1,n.apply(t,[e]))}function b(t){var n,r=!1;if(e(t)&&t.hasOwnProperty("get")){for(n in t)if("get"!==n)return!1;r=!t.get.hasOwnProperty("callback")}return r}function j(){return T.geocoder||(T.geocoder=new q.Geocoder),T.geocoder}function k(){var t=[];this.get=function(n){if(t.length){var r,o,a,i,u,s=l(n);for(r=0;r<t.length;r++){for(i=t[r],u=s.length===i.keys.length,o=0;o<s.length&&u;o++)a=s[o],u=a in i.request,u&&(u=e(n[a])&&"equals"in n[a]&&x(n[a])?n[a].equals(i.request[a]):n[a]===i.request[a]);if(u)return i.results}}},this.store=function(n,e){t.push({request:n,keys:l(n),results:e})}}function I(){var t=[],n=this;n.empty=function(){return!t.length},n.add=function(n){t.push(n)},n.get=function(){return t.length?t[0]:!1},n.ack=function(){t.shift()}}function O(){function n(t){return{id:t.id,name:t.name,object:t.obj,tag:t.tag,data:t.data}}function e(t){x(t.setMap)&&t.setMap(null),x(t.remove)&&t.remove(),x(t.free)&&t.free(),t=null}var r={},o={},i=this;i.add=function(t,n,e,a){var s=t.td||{},l=u(s.id);return r[n]||(r[n]=[]),l in o&&i.clearById(l),o[l]={obj:e,sub:a,name:n,id:l,tag:s.tag,data:s.data},r[n].push(l),l},i.getById=function(t,e,r){var a=!1;return t in o&&(a=e?o[t].sub:r?n(o[t]):o[t].obj),a},i.get=function(t,e,a,i){var u,s,l=h(a);if(!r[t]||!r[t].length)return null;for(u=r[t].length;u;)if(u--,s=r[t][e?u:r[t].length-u-1],s&&o[s]){if(l&&!l(o[s].tag))continue;return i?n(o[s]):o[s].obj}return null},i.all=function(t,e,i){var u=[],s=h(e),l=function(t){var e,a;for(e=0;e<r[t].length;e++)if(a=r[t][e],a&&o[a]){if(s&&!s(o[a].tag))continue;u.push(i?n(o[a]):o[a].obj)}};if(t in r)l(t);else if(a(t))for(t in r)l(t);return u},i.rm=function(t,n,e){var a,u;if(!r[t])return!1;if(n)if(e)for(a=r[t].length-1;a>=0&&(u=r[t][a],!n(o[u].tag));a--);else for(a=0;a<r[t].length&&(u=r[t][a],!n(o[u].tag));a++);else a=e?r[t].length-1:0;return a in r[t]?i.clearById(r[t][a],a):!1},i.clearById=function(t,n){if(t in o){var i,u=o[t].name;for(i=0;a(n)&&i<r[u].length;i++)t===r[u][i]&&(n=i);return e(o[t].obj),o[t].sub&&e(o[t].sub),delete o[t],r[u].splice(n,1),!0}return!1},i.objGetById=function(t){var n,e;if(r.clusterer)for(e in r.clusterer)if((n=o[r.clusterer[e]].obj.getById(t))!==!1)return n;return!1},i.objClearById=function(t){var n;if(r.clusterer)for(n in r.clusterer)if(o[r.clusterer[n]].obj.clearById(t))return!0;return null},i.clear=function(t,n,e,o){var a,u,s,l=h(o);if(t&&t.length)t=d(t);else{t=[];for(a in r)t.push(a)}for(u=0;u<t.length;u++)if(s=t[u],n)i.rm(s,l,!0);else if(e)i.rm(s,l,!1);else for(;i.rm(s,l,!1););},i.objClear=function(n,e,a,i){var u;if(r.clusterer&&(t.inArray("marker",n)>=0||!n.length))for(u in r.clusterer)o[r.clusterer[u]].obj.clear(e,a,i)}}function M(n,e,o){function a(t){var n={};return n[t]={},n}function i(){var t;for(t in o)if(o.hasOwnProperty(t)&&!s.hasOwnProperty(t))return t}var u,s={},l=this,c={latLng:{map:!1,marker:!1,infowindow:!1,circle:!1,overlay:!1,getlatlng:!1,getmaxzoom:!1,getelevation:!1,streetviewpanorama:!1,getaddress:!0},geoloc:{getgeoloc:!0}};r(o)&&(o=a(o)),l.run=function(){for(var r,a;r=i();){if(x(n[r]))return u=r,a=t.extend(!0,{},B[r]||{},o[r].options||{}),void(r in c.latLng?o[r].values?L(o[r].values,n,n[r],{td:o[r],opts:a,session:s}):m(n,n[r],c.latLng[r],{td:o[r],opts:a,session:s}):r in c.geoloc?w(n,n[r],{td:o[r],opts:a,session:s}):n[r].apply(n,[{td:o[r],opts:a,session:s}]));s[r]=null}e.apply(n,[o,s])},l.ack=function(t){s[u]=t,l.run.apply(l,[])}}function P(n){function e(){!u&&(u=c.get())&&u.run()}function r(){u=null,c.ack(),e.call(l)}function o(t){var e,r=t.td.callback;r&&(e=Array.prototype.slice.call(arguments,1),x(r)?r.apply(n,e):C(r)&&x(r[1])&&r[1].apply(r[0],e))}function a(t,e,r){r&&s(n,t,e,r),o(t,e),u.ack(e)}function i(e,r){r=r||{};var o=r.td&&r.td.options?r.td.options:0;p?o&&(o.center&&(o.center=v(o.center)),p.setOptions(o)):(o=r.opts||t.extend(!0,{},B.map,o||{}),o.center=e||v(o.center),p=new B.classes.Map(n.get(0),o))}var u,l=this,c=new I,g=new O,p=null;l._plan=function(t){var n;for(n=0;n<t.length;n++)c.add(new M(l,r,t[n]));e()},l.map=function(t){i(t.latLng,t),s(n,t,p),a(t,p)},l.destroy=function(t){g.clear(),n.empty(),p&&(p=null),a(t,!0)},l.marker=function(e){var r,o="values"in e.td,u=!p;return o||(e.opts.position=e.latLng||v(e.opts.position),e.td.values=[{options:e.opts}]),e.td.values.length?(u&&i(),r=[],t.each(e.td.values,function(t,o){var a,i,l=f(e,o);l.options.position=v(l.options.position?l.options.position:o),l.options.position&&(l.options.map=p,u&&(p.setCenter(l.options.position),u=!1),i=new B.classes.Marker(l.options),r.push(i),a=g.add({td:l},"marker",i),s(n,{td:l},i,a))}),void a(e,o?r:r[0])):void a(e,!1)}}var B,q,A=0,x=t.isFunction,C=t.isArray,T={},G=new k;t.fn.gmap3=function(){var n,e=[],r=!0,o=[];for(i(),n=0;n<arguments.length;n++)arguments[n]&&e.push(arguments[n]);return e.length||e.push("map"),t.each(this,function(){var n=t(this),a=n.data("gmap3");r=!1,a||(a=new P(n),n.data("gmap3",a)),1!==e.length||"get"!==e[0]&&!b(e[0])?a._plan(e):o.push("get"===e[0]?a.get("map",!0):a.get(e[0].get,!0,e[0].get.full))}),o.length?1===o.length?o[0]:o:this}}(jQuery);