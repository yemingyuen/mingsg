/*
 * Better Select Multiple - jQuery Plugin
 *
 * based on Alternate Select Multiple (asmSelect) 1.0.4a beta (http://www.ryancramer.com/projects/asmselect/)
 *
 * Copyright (c) 2009 by Ryan Cramer - http://www.ryancramer.com
 * Copyright (c) 2010-2013 by Victor Berchet - http://www.github.com/vicb
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt) and GPL (GPL-LICENSE.txt) licenses.
 *
 * bsmSelect version: v1.4.6 - 2013-03-02
 */

;(function(a){function g(c,b){this.$original=a(c);this.ignoreOriginalChangeEvent=this.ieClick=this.buildingSelect=!1;this.options=b;this.buildDom()}g.prototype={generateUid:function(a){return this.uid=this.options.containerClass+a},buildDom:function(){var c=this,b=this.options;"original"===b.addItemTarget&&a("option",this.$original).each(function(c,b){void 0===a(b).data("bsm-order")&&a(b).data("bsm-order",c)});for(var d=0;a("#"+this.generateUid(d)).size();d++);this.$select=a("<select>",{"class":b.selectClass,name:b.selectClass+this.uid,id:b.selectClass+this.uid,change:a.proxy(this.selectChangeEvent,this),click:a.proxy(this.selectClickEvent,this)});this.$list=a.isFunction(b.listType)?b.listType(this.$original):a("<"+b.listType+">",{id:b.listClass+this.uid});this.$list.addClass(b.listClass);this.$container=a("<div>",{"class":b.containerClass,id:this.uid});this.buildSelect();this.$original.change(a.proxy(this.originalChangeEvent,this)).wrap(this.$container).before(this.$select);this.$list.parent().length||this.$original.before(this.$list);this.$original.attr("id")&&a("label[for="+this.$original.attr("id")+"]").attr("for",this.$select.attr("id"));this.$list.delegate('a[href="#"]',"click",function(){c.dropListItem(a(this).closest("li"));return!1});a.each(b.plugins,function(){this.init(c)})},selectChangeEvent:function(){if(!(a.browser&&a.browser.msie&&7>a.browser.version)||this.ieClick){var c=a("option:selected:eq(0)",this.$select);c.data("orig-option")&&(this.addListItem(c),this.triggerOriginalChange(c.data("orig-option"),"add"));this.ieClick=!1}},selectClickEvent:function(){this.ieClick=!0},originalChangeEvent:function(){this.ignoreOriginalChangeEvent?this.ignoreOriginalChangeEvent=!1:(this.buildSelect(),a.browser&&a.browser.opera&&this.$list.hide().show())},buildSelect:function(){var c=this;this.buildingSelect=!0;this.$select.empty().prepend(a('<option value=""></option>').text(this.$original.attr("title")||this.options.title));this.$list.empty();this.$original.children().each(function(){a(this).is("option")?c.addSelectOption(c.$select,a(this)):a(this).is("optgroup")&&c.addSelectOptionGroup(c.$select,a(this))});this.options.debugMode||this.$original.hide();this.selectFirstItem();this.buildingSelect=!1},addSelectOption:function(c,b){var d=a("<option>",{text:b.text(),val:b.val()}).appendTo(c).data("orig-option",b),e=b.is(":selected"),f=b.is(":disabled");b.data("bsm-option",d);e&&!f?(this.addListItem(d),this.disableSelectOption(d)):!e&&f&&this.disableSelectOption(d)},addSelectOptionGroup:function(c,b){var d=this,e=a("<optgroup>",{label:b.attr("label")}).appendTo(c);b.is(":disabled")&&e.attr("disabled","disabled");a("option",b).each(function(){d.addSelectOption(e,a(this))})},selectFirstItem:function(){a("option:eq(0)",this.$select).attr("selected","selected")},disableSelectOption:function(c){c.addClass(this.options.optionDisabledClass).removeAttr("selected").attr("disabled","disabled").toggle(!this.options.hideWhenAdded);a.browser&&a.browser.msie&&8>a.browser.version&&this.$select.hide().show()},enableSelectOption:function(c){c.removeClass(this.options.optionDisabledClass).removeAttr("disabled").toggle(!this.options.hideWhenAdded);a.browser&&a.browser.msie&&8>a.browser.version&&this.$select.hide().show()},addListItem:function(c){var b,d=c.data("orig-option"),e=this.options;if(d){if(!this.buildingSelect){if(d.is(":selected"))return;d.attr("selected","selected")}b=a("<li>",{"class":e.listItemClass}).append(a("<span>",{"class":e.listItemLabelClass,html:e.extractLabel(c,e)})).append(a("<a>",{href:"#","class":e.removeClass,html:e.removeLabel})).data("bsm-option",c);this.disableSelectOption(c.data("item",b));switch(e.addItemTarget){case "bottom":this.$list.append(b.hide());break;case "original":var f=d.data("bsm-order"),h=!1;this.$list.children().each(function(){if(f<a(this).data("bsm-option").data("orig-option").data("bsm-order"))return b.hide().insertBefore(this),h=!0,!1});h||this.$list.append(b.hide());break;default:this.$list.prepend(b.hide())}this.buildingSelect?a.bsmSelect.effects.show(b):(e.showEffect(b),e.highlightEffect(this.$select,b,e.highlightAddedLabel,this.options),this.selectFirstItem())}},dropListItem:function(c){var b=c.data("bsm-option"),d=this.options;b.removeData("item").data("orig-option").removeAttr("selected");(this.buildingSelect?a.bsmSelect.effects.remove:d.hideEffect)(c);this.enableSelectOption(b);d.highlightEffect(this.$select,c,d.highlightRemovedLabel,d);this.triggerOriginalChange(b.data("orig-option"),"drop")},triggerOriginalChange:function(a,b){this.ignoreOriginalChangeEvent=!0;this.$original.trigger("change",[{option:a,value:a.val(),item:a.data("bsm-option").data("item"),type:b}])}};a.fn.bsmSelect=function(c){var b=a.extend({},a.bsmSelect.conf,c);return this.each(function(){var c=a(this).data("bsmSelect");c||(c=new g(a(this),b),a(this).data("bsmSelect",c))})};a.bsmSelect={};a.extend(a.bsmSelect,{effects:{show:function(a){a.show()},remove:function(a){a.remove()},highlight:function(c,b,d,e){var f=c.attr("id")+e.highlightClass;a("#"+f).remove();b=a("<span>",{"class":e.highlightClass,id:f,html:d+b.children("."+e.listItemLabelClass).first().text()}).hide();c.after(b.fadeIn("fast").delay(50).fadeOut("slow",function(){a(this).remove()}))},verticalListAdd:function(c){c.animate({opacity:"show",height:"show"},100,function(){a(this).animate({height:"+=2px"},100,function(){a(this).animate({height:"-=2px"},100)})})},verticalListRemove:function(c){c.animate({opacity:"hide",height:"hide"},100,function(){a(this).prev("li").animate({height:"-=2px"},100,function(){a(this).animate({height:"+=2px"},100)});a(this).remove()})}},plugins:{}});a.bsmSelect.conf={listType:"ol",showEffect:a.bsmSelect.effects.show,hideEffect:a.bsmSelect.effects.remove,highlightEffect:a.noop,addItemTarget:"bottom",hideWhenAdded:!1,debugMode:!1,title:"Select...",removeLabel:"remove",highlightAddedLabel:"Added: ",highlightRemovedLabel:"Removed: ",extractLabel:function(a){return a.html()},plugins:[],containerClass:"bsmContainer",selectClass:"bsmSelect",optionDisabledClass:"bsmOptionDisabled",listClass:"bsmList",listItemClass:"bsmListItem",listItemLabelClass:"bsmListItemLabel",removeClass:"bsmListItemRemove",highlightClass:"bsmHighlight"};a.bsmSelect.plugins.sortable=function(c,b){if(!(this instanceof a.bsmSelect.plugins.sortable))return new a.bsmSelect.plugins.sortable(c,b);this.sortConfig=c;this.options=a.extend({},this.defaultOpt,b||{})};a.extend(a.bsmSelect.plugins.sortable.prototype,{defaultOpt:{listSortableClass:"bsmListSortable"},init:function(c){var b=a.extend({},this.options,c.options),d=a.extend({},this.sortConfig,{items:"."+b.listItemClass}),e=this;c.$list.addClass(b.listSortableClass).sortable(d);(-1<a.inArray(a("html").css("overflow-x"),["auto","scroll"])||-1<a.inArray(a("html").css("overflow-y"),["auto","scroll"]))&&a("."+b.listSortableClass).addClass("bsmScrollWorkaround");c.$original.bind("change",function(a,b){e.onChange.call(e,c,a,b)});c.$list.bind("sortupdate",function(a,b){e.onSort.call(e,c,a,b)})},onChange:function(a,b,d){d&&"add"===d.type&&!a.buildingSelect&&(d.option.detach()["top"===a.options.addItemTarget?"prependTo":"appendTo"](a.$original),a.$list.sortable("refresh"))},onSort:function(c,b,d){a("."+c.options.listItemClass,c.$list).each(function(){a(this).data("bsm-option").data("orig-option").detach().appendTo(c.$original)});c.triggerOriginalChange(a(d.item).data("bsm-option").data("orig-option"),"sort")}})})(jQuery);