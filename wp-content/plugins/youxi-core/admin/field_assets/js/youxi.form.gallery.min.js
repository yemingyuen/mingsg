/**
 * Youxi Gallery Form Field JS
 *
 * This script contains the initialization code for the gallery form field.
 *
 * @package   Youxi Core
 * @author    Mairel Theafila <maimairel@gmail.com>
 * @copyright Copyright (c) 2013-2015, Mairel Theafila
 */
;(function(b,e,f,g){if("undefined"!=typeof wp&&wp.media&&wp.media.gallery&&b.widget){var c=wp.media.gallery;b.widget("youxi.galleryform",{options:{fieldName:""},_mediaTemplate:wp.media.template("youxi-gallery-preview"),_create:function(){this._on({click:function(a){this.open();a.preventDefault()}});this.ids=b(".youxi-gallery-preview-item",this.element).map(function(){return b(this).find("input.youxi-gallery-value").val()}).get();this.ids.length||c.attachments(wp.shortcode.next("gallery","[gallery]").shortcode).more()},_handleUpdate:function(a){var d=a.map(function(a){return this._mediaTemplate({id:a.id,url:this._getAttachmentSize(a,"thumbnail").url,fieldName:this.options.fieldName})},this).join("");this.ids=a.pluck("id");b(".youxi-gallery-previews",this.element).html(d)},_getAttachmentSize:function(a,b){var c=a.attributes.sizes||{};return _.has(c,b)?_.pick(c[b],"url"):{url:a.url}},open:function(){var a=c.edit("[gallery"+(this.ids?' ids="'+this.ids.join(",")+'"':"")+"]");a.state("gallery-edit").on("update",this._handleUpdate,this);a.on("close",function(){a.detach()})}});b.Youxi.Form.Manager&&b.Youxi.Form.Manager.addCallbacks("gallery_form",function(a){b.fn.galleryform&&b(".youxi-gallery-form",a).each(function(){b(this).galleryform(b(this).data())})},function(a){b.fn.galleryform&&b(".youxi-gallery-form:youxi-galleryform",a).each(function(){b(this).galleryform("destroy")})})}})(jQuery,window,document);